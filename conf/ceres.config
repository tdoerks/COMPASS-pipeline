/*
 * -------------------------------------------------
 *  Ceres HPC cluster config
 * -------------------------------------------------
 * Configuration for USDA ARS SCINet Ceres cluster
 * https://scinet.usda.gov/guides/resources/ceres
 *
 * Available partitions on Ceres:
 *   - short      (2 hours, 6 nodes)
 *   - medium     (2 days, 60 nodes)
 *   - long       (21 days, 16 nodes)
 *   - mem        (7 days, high memory)
 *   - longmem    (1000 hours, high memory)
 */

process {
    executor = 'slurm'
    queue = 'medium'  // Default to medium partition (2 days max)

    // Ceres-specific error handling
    errorStrategy = { task.exitStatus in [143,137,104,134,139] ? 'retry' : 'finish' }
    maxRetries = 3

    // Use the long partition for longer-running processes
    withName: 'VIBRANT|ASSEMBLE_SPADES' {
        queue = 'long'
    }

    // Use short partition for quick jobs
    withName: 'DOWNLOAD_.*|FILTER_.*' {
        queue = 'short'
        clusterOptions = '--qos=short'
    }
}

// Cluster-specific parameters
params {
    // Ceres resource limits
    max_memory = 1500.GB  // Available on mem/longmem nodes
    max_cpus = 72         // Max cores per node on Ceres
    max_time = 21.d       // Max for long partition
}

// Additional settings for SLURM
executor {
    queueSize = 100
    submitRateLimit = '10 sec'
}

// Note: Users should update database paths for Ceres
// Example:
// params.prophage_db = "/project/<your-project>/databases/prophage_db.dmnd"
// params.checkv_db = "/project/<your-project>/databases/checkv-db-v1.5"
