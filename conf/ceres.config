/*
 * -------------------------------------------------
 *  USDA SCINet Ceres HPC Configuration
 * -------------------------------------------------
 * Configuration for running COMPASS pipeline on USDA SCINet Ceres cluster
 * https://scinet.usda.gov/guides/resources/ceres
 */

params {
    config_profile_name = 'Ceres'
    config_profile_description = 'USDA SCINet Ceres HPC cluster profile'
    config_profile_contact = 'SCINet Support <scinet-vrsc@usda.gov>'
    config_profile_url = 'https://scinet.usda.gov/guides/resources/ceres'

    // Maximum resources available on Ceres
    // Standard nodes: 48 cores, 384 GB RAM
    // High-memory nodes: 80 cores, 1.5 TB RAM
    max_cpus = 48
    max_memory = 384.GB
    max_time = 336.h  // 14 days
}

process {
    executor = 'slurm'
    queue = 'short'  // Default to short queue (< 48 hours)

    // Ceres-specific SLURM options
    clusterOptions = '--mail-type=END,FAIL'

    // Use longer queue for processes that may need more time
    withName: 'VIBRANT|ASSEMBLE_SPADES' {
        queue = 'medium'  // medium queue allows up to 7 days
    }
}

// Apptainer/Singularity configuration for Ceres
apptainer {
    enabled = true
    autoMounts = true
    cacheDir = "$TMPDIR/.apptainer/cache"
    runOptions = '--cleanenv --no-home'
}

singularity {
    enabled = true
    autoMounts = true
    cacheDir = "$TMPDIR/.singularity/cache"
    runOptions = '--cleanenv --no-home'
}

// Enable execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline_ceres.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report_ceres.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace_ceres.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag_ceres.svg"
}
