/*
 * -------------------------------------------------
 *  Global Error Handling Configuration
 * -------------------------------------------------
 *  Defines error strategies for all processes to allow pipeline continuation
 */

process {
    // Global error strategy: Continue pipeline even if individual samples fail
    errorStrategy = { task.exitStatus in [143,137,104,134,139,140] ? 'retry' : task.attempt < 3 ? 'retry' : 'ignore' }
    maxRetries = 2
    maxErrors = '-1'  // Unlimited errors allowed - don't stop pipeline

    // Process-specific error strategies
    withName: 'DOWNLOAD_SRA' {
        errorStrategy = { task.attempt < 3 ? 'retry' : 'ignore' }
        maxRetries = 2
    }

    withName: 'ASSEMBLE_SPADES' {
        errorStrategy = { task.attempt < 2 ? 'retry' : 'ignore' }
        maxRetries = 1
    }

    withName: 'AMRFINDER' {
        errorStrategy = { task.attempt < 2 ? 'retry' : 'ignore' }
        maxRetries = 1
    }

    withName: 'VIBRANT' {
        errorStrategy = { task.attempt < 2 ? 'retry' : 'ignore' }
        maxRetries = 1
    }

    withName: 'DIAMOND_PROPHAGE' {
        errorStrategy = 'ignore'  // Always continue even if fails
    }

    withName: 'CHECKV' {
        errorStrategy = 'ignore'  // Always continue even if fails
    }

    withName: 'PHANOTATE' {
        errorStrategy = 'ignore'  // Always continue even if fails
    }
}
