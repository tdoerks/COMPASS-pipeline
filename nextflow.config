params {
    input = "samplesheet.csv"
    outdir = "results"
    
    // Metadata filtering parameters
    filter_state = "KS"           // State code (e.g., "KS", "CA", "TX")
    filter_year_start = null      // Minimum year (e.g., 2020)
    filter_year_end = null        // Maximum year (e.g., 2023)
    filter_source = null          // Source pattern (e.g., "chicken", "clinical")
    
    // AMR parameters
    amrfinder_db = ""
    
    // Phage parameters
    prophage_db = "/homes/tylerdoe/databases/prophage_db.dmnd"
    checkv_db = "/homes/tylerdoe/databases/checkv-db-v1.5"
}

process {
    executor = 'slurm'
    queue = 'batch.q'

    // Resource allocations for each process
    // Container images are defined in individual module files for better portability

    withName: 'DOWNLOAD_AMRFINDER_DB' {
        cpus = 1
        memory = '2.GB'
        time = '30m'
    }

    withName: 'AMRFINDER' {
        cpus = 4
        memory = '8.GB'
        time = '1h'
    }

    withName: 'VIBRANT' {
        cpus = 8
        memory = '16.GB'
        time = '12h'
    }

    withName: 'DOWNLOAD_PROPHAGE_DB' {
        cpus = 4
        memory = '8.GB'
        time = '2h'
    }

    withName: 'DIAMOND_PROPHAGE' {
        cpus = 4
        memory = '8.GB'
        time = '1h'
    }

    withName: 'CHECKV' {
        cpus = 2
        memory = '8.GB'
        time = '2h'
    }

    withName: 'PHANOTATE' {
        cpus = 2
        memory = '4.GB'
        time = '2h'
    }

    withName: 'DOWNLOAD_NARMS_METADATA' {
        cpus = 1
        memory = '2.GB'
    }

    withName: 'FILTER_NARMS_SAMPLES' {
        cpus = 1
        memory = '4.GB'
    }

    withName: 'DOWNLOAD_SRA' {
        cpus = 4
        memory = '8.GB'
        time = '2h'
    }

    withName: 'ASSEMBLE_SPADES' {
        cpus = 8
        memory = '32.GB'
        time = '12h'
    }

    withName: 'COMBINE_RESULTS' {
        cpus = 1
        memory = '4.GB'
        time = '30m'
    }
}

apptainer {
    enabled = true
    autoMounts = true
    cacheDir = "$HOME/.apptainer/cache"
}
